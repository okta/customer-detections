title: User Authenticates from a New Device through a Proxy
id: 1796b1dff54ce33f748ed43266fc71c6
description: |
  Detects successful user authentication events, using a new device, from IPs that Okta identifies as proxies in locations not associated with the user's typical behavior.
  An adversary may attempt to login with compromised credentials from a known anonymizer with an unrecognized device.
references:
  - https://www.okta.com/blog/threat-intelligence/phishing-campaigns-use-employee-benefits-lure-logins
  - https://help.okta.com/oie/en-us/content/topics/identity-engine/network/create-dynamic-zone.htm
author:
  - Datadog
  - Okta
created_date: "2025-01-06"
modified_date: "2025-01-06"
threat:
  Tactic:
    - Initial Access
  Technique:
    - T1078: Valid Accounts
    - T1566: Phishing
prevention:
  - Configure a dynamic network zone blocklist to pro-actively block these proxies.
  - Configure authentication policies to only allow authentications from certain approved network ranges.
  - Require phishing resistant MFA (Okta FastPass, FIDO2 WebAuthn) for login attempts from new devices or IPs.
detection:
  okta_systemlog:
    OIE: |
      eventType co "user.authentication" and outcome.result eq "SUCCESS" and securityContext.isProxy eq "true" and actor.alternateId ne "system@okta.com" and (debugContext.debugData.behaviors co "New Device=POSITIVE" and debugContext.debugData.behaviors co "New Geo-Location=POSITIVE")
    datadog: |
      source:okta @evt.name:user.authentication* @evt.outcome:SUCCESS @securityContext.isProxy:true -@usr.email:system@okta.com @debugContext.debugData.behaviors:(*Device=POSITIVE* AND *Location=POSITIVE*)
false_positives:
  - Corporate environments may leverage common VPN providers.
  - Potential false positives in IP reputation from our service provider.
  - Review abnormal authentication patterns from the same source IP.
